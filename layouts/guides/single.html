{{ define "main" }}
<div class="container mx-auto px-4 py-8">
    <!-- Guide Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <div class="flex flex-wrap items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
                {{ $guideTypeColor := "blue" }}
                {{ if eq .Params.guide_type "how-to" }}{{ $guideTypeColor =
                "green" }}{{ end }}
                {{ if eq .Params.guide_type "comparison" }}{{ $guideTypeColor =
                "purple" }}{{ end }}
                {{ if eq .Params.guide_type "troubleshooting" }}{{
                $guideTypeColor = "orange" }}{{ end }}

                <span
                    class="px-3 py-1 bg-{{ $guideTypeColor }}-100 text-{{ $guideTypeColor }}-800 rounded-full text-sm font-medium">
                    {{ .Params.guide_type | title | replace "-" " " }}
                </span>

                {{ $difficultyColor := "green" }}
                {{ if eq .Params.difficulty "intermediate" }}{{ $difficultyColor
                = "yellow" }}{{ end }}
                {{ if eq .Params.difficulty "advanced" }}{{ $difficultyColor =
                "red" }}{{ end }}

                <span
                    class="px-3 py-1 bg-{{ $difficultyColor }}-100 text-{{ $difficultyColor }}-800 rounded-full text-sm font-medium">
                    {{ .Params.difficulty | title }}
                </span>
            </div>
            <div class="flex space-x-2">
                <button
                    class="bookmark-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                    data-item-id="{{ .RelPermalink }}">
                    Bookmark
                </button>
                <button
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    Share
                </button>
            </div>
        </div>

        <h1 class="text-3xl font-bold mb-4">{{ .Title }}</h1>
        <p class="text-gray-600 text-lg">{{ .Description }}</p>
    </div>

    <div class="grid lg:grid-cols-4 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-3">
            <div class="prose max-w-none guide-content">
                {{ .Content }}
            </div>

            <!-- Related Guides -->
            <div class="mt-12 p-6 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-semibold mb-4">Related Guides</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    {{ $related := .Site.RegularPages.Related . | first 4 }}
                    {{ range $related }}
                    <a href="{{ .Permalink }}"
                        class="block p-4 bg-white rounded-lg border hover:shadow-md transition-shadow">
                        <h4 class="font-semibold mb-2">{{ .Title }}</h4>
                        <p class="text-sm text-gray-600 mb-2">{{ .Description |
                            truncate 100 }}</p>
                        <div
                            class="flex items-center space-x-2 text-xs text-gray-500">
                            <span class="px-2 py-1 bg-gray-100 rounded">{{
                                .Params.guide_type | title }}</span>
                            <span class="px-2 py-1 bg-gray-100 rounded">{{
                                .Params.difficulty | title }}</span>
                        </div>
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <!-- Table of Contents -->
            {{ if .Params.toc }}
            <div class="bg-white rounded-lg shadow-md p-4 mb-6 sticky top-4">
                <h3 class="text-lg font-semibold mb-3">Table of Contents</h3>
                <div id="toc" class="text-sm space-y-1">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
            {{ end }}

            <!-- Quick Actions -->
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <h3 class="text-lg font-semibold mb-3">Quick Actions</h3>
                <div class="space-y-2">
                    <a href="/learn/tutorials/"
                        class="block w-full px-4 py-2 text-center bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Find Related Tutorials
                    </a>
                    <a href="/learn/projects/"
                        class="block w-full px-4 py-2 text-center bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        Practice Projects
                    </a>
                    <button
                        class="block w-full px-4 py-2 text-center bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Print Guide
                    </button>
                </div>
            </div>

            <!-- Guide Info -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="text-lg font-semibold mb-3">Guide Information</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Type:</span>
                        <span class="font-medium">{{ .Params.guide_type | title
                            | replace "-" " " }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Difficulty:</span>
                        <span class="font-medium">{{ .Params.difficulty | title
                            }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Last Updated:</span>
                        <span class="font-medium">{{ .Date.Format "Jan 2, 2006"
                            }}</span>
                    </div>
                    {{ if .Params.tags }}
                    <div>
                        <span class="text-gray-600 block mb-2">Tags:</span>
                        <div class="flex flex-wrap gap-1">
                            {{ range .Params.tags }}
                            <span
                                class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">{{
                                . }}</span>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Generate table of contents
        const toc = document.getElementById('toc');
        if (toc) {
            const headings = document.querySelectorAll('.guide-content h2, .guide-content h3, .guide-content h4');

            headings.forEach((heading, index) => {
                const id = `heading-${index}`;
                heading.id = id;

                const tocItem = document.createElement('a');
                tocItem.href = `#${id}`;
                tocItem.textContent = heading.textContent;

                let className = 'block py-1 text-gray-600 hover:text-blue-600 transition-colors';
                if (heading.tagName === 'H3') className += ' ml-4';
                if (heading.tagName === 'H4') className += ' ml-8';

                tocItem.className = className;
                toc.appendChild(tocItem);
            });
        }
    });
</script>
{{ end }}