<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Favicon and App Icons -->
<link rel="apple-touch-icon" sizes="180x180"
  href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32"
  href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16"
  href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- SEO and Meta Tags -->
{{ partial "meta" . }}

<!-- DNS prefetch and preconnect for external resources -->
<link href="//cdn.jsdelivr.net" rel="dns-prefetch">
<link href="https://cdn.jsdelivr.net" rel="preconnect" crossorigin="anonymous">

<!-- Preload critical resources -->
{{ if .IsHome }}
{{ $heroImage := resources.Get "images/pages/tailbliss-rocket-indigo.png" }}
{{ if $heroImage }}
{{ $heroWebP := $heroImage.Resize "576x576 webp q85" }}
<link href="{{ $heroWebP.RelPermalink }}" rel="preload" as="image"
  fetchpriority="high" loading="eager">
{{ else }}
<link as="image" href="/images/tailbliss-rocket-indigo.webp" rel="preload"
  fetchpriority="high" loading="eager">
{{ end }}
{{ end }}

<!-- Preload site logo -->
{{ if .Site.Params.brand.logo }}
<link href="{{ .Site.Params.brand.logo }}" rel="preload" as="image"
  fetchpriority="high" loading="eager">
{{ else }}
<link href="/images/site-logo.svg" rel="preload" as="image" fetchpriority="high"
  loading="eager">
{{ end }}

<!-- Alpine.js for interactive components -->
<link href="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"
  as="script" rel="preconnect" rel="dns-prefetch">

<!-- Hide Alpine.js [x-cloak] elements until Alpine initializes -->
<style>
  [x-cloak] {
    display: none !important;
  }

  /* Line clamp utility for text truncation */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    line-clamp: 3;
    overflow: hidden;
  }
</style>

<!-- Dark mode script - must be in head to prevent FOUC -->
<script>
  // Initialize theme based on localStorage or system preference
  if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark')
  }
</script>

<!-- CSS Assets -->
{{ $mainCSS := "" }}

<!-- Check if we have a processed main CSS file -->
{{ $mainCSSResource := resources.Get "css/main.css" }}
{{ if $mainCSSResource }}
{{ $mainCSS = $mainCSSResource.RelPermalink }}
{{ else }}
<!-- Fallback: look for static CSS files -->
{{ $mainCSS = "/css/main.css" }}
{{ end }}

<!-- Load main CSS -->
{{ if $mainCSS }}
<link rel="stylesheet" href="{{ $mainCSS }}">
{{ else }}
<!-- Fallback to Hugo PostCSS processing -->
{{ $styles := resources.Get "css/main.css" }}
{{ if $styles }}
{{ $styles := $styles | postCSS }}
{{ if hugo.IsProduction }}
{{ $styles := $styles | minify | fingerprint | resources.PostProcess }}
{{ end }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
{{ end }}
{{ end }}

<!-- Custom CSS overrides -->
{{ $customStyles := resources.Get "css/custom.css" }}
{{ if $customStyles }}
{{ $customStyles := $customStyles | postCSS }}
{{ if hugo.IsProduction }}
{{ $customStyles := $customStyles | minify | fingerprint | resources.PostProcess
}}
{{ end }}
<link rel="stylesheet" href="{{ $customStyles.RelPermalink }}" />
{{ end }}