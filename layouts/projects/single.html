{{ define "main" }}
<div class="container mx-auto px-4 py-8">
    <!-- Project Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <div class="flex flex-wrap items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
                {{ $difficultyColor := "green" }}
                {{ if eq .Params.difficulty "intermediate" }}{{ $difficultyColor
                = "yellow" }}{{ end }}
                {{ if eq .Params.difficulty "advanced" }}{{ $difficultyColor =
                "red" }}{{ end }}

                <span
                    class="px-3 py-1 bg-{{ $difficultyColor }}-100 text-{{ $difficultyColor }}-800 rounded-full text-sm font-medium">
                    {{ .Params.difficulty | title }}
                </span>
                <span class="text-gray-600">
                    <svg class="w-4 h-4 inline mr-1" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
                        </path>
                    </svg>
                    {{ .Params.duration | default "2 hours" }}
                </span>
                <span class="text-gray-600">
                    <svg class="w-4 h-4 inline mr-1" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1">
                        </path>
                    </svg>
                    {{ .Params.cost | default "$10-20" }}
                </span>
            </div>
            <div class="flex space-x-2">
                {{ if .Params.progress_tracking }}
                <button id="start-project-btn"
                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    Start Project
                </button>
                {{ end }}
                <button
                    class="bookmark-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                    data-item-id="{{ .RelPermalink }}">
                    Save Project
                </button>
            </div>
        </div>

        <h1 class="text-3xl font-bold mb-4">{{ .Title }}</h1>
        <p class="text-gray-600 text-lg">{{ .Description }}</p>
    </div>

    <div class="grid lg:grid-cols-4 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-3">
            <!-- Project Overview -->
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-2">What You'll
                    Learn</h3>
                {{ if .Params.skills_practiced }}
                <ul class="list-disc list-inside text-blue-700">
                    {{ range .Params.skills_practiced }}
                    <li>{{ . }}</li>
                    {{ end }}
                </ul>
                {{ end }}
            </div>

            <!-- Project Content -->
            <div class="prose max-w-none project-content">
                {{ .Content }}
            </div>

            <!-- Progress Tracking -->
            {{ if .Params.progress_tracking }}
            <div id="project-progress" class="mt-8 p-6 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-semibold mb-4">Project Progress</h3>
                <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                    <div id="progress-bar"
                        class="bg-green-600 h-3 rounded-full transition-all duration-300"
                        style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm text-gray-600 mb-4">
                    <span>Progress: <span id="progress-text">0%</span></span>
                    <span id="phases-completed">0 of 0 phases completed</span>
                </div>
                <div class="flex space-x-2">
                    <button id="prev-phase"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"
                        disabled>
                        Previous Phase
                    </button>
                    <button id="next-phase"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Complete Current Phase
                    </button>
                </div>
            </div>
            {{ end }}

            <!-- Skill Assessment -->
            {{ if .Params.skill_assessment }}
            <div
                class="mt-8 p-6 bg-green-50 border border-green-200 rounded-lg">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Project
                    Assessment</h3>
                <p class="text-green-700 mb-4">Test your understanding of the
                    techniques used in this project.</p>
                <button
                    class="start-assessment px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                    data-assessment-id="project-{{ .File.BaseFileName }}">
                    Start Assessment
                </button>
            </div>
            {{ end }}

            <!-- Project Gallery -->
            <div class="mt-8 p-6 bg-white rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">Community Builds</h3>
                <p class="text-gray-600 mb-4">See how others have completed this
                    project and share your own build!</p>
                <div class="grid md:grid-cols-3 gap-4">
                    <!-- Placeholder for community builds -->
                    <div class="bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-32 bg-gray-200 rounded-lg mb-3">
                        </div>
                        <p class="text-sm text-gray-600">Share your build to be
                            featured here!</p>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-32 bg-gray-200 rounded-lg mb-3">
                        </div>
                        <p class="text-sm text-gray-600">Upload photos of your
                            completed project</p>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4 text-center">
                        <button
                            class="w-full h-32 bg-blue-100 border-2 border-dashed border-blue-300 rounded-lg flex items-center justify-center hover:bg-blue-200 transition-colors">
                            <div class="text-center">
                                <svg class="w-8 h-8 text-blue-500 mx-auto mb-2"
                                    fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round"
                                        stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                <p class="text-sm text-blue-600 font-medium">
                                    Upload Your Build</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <!-- Tools Required -->
            {{ if .Params.tools_required }}
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <h3 class="text-lg font-semibold mb-3">Tools Required</h3>
                <ul class="space-y-2">
                    {{ range .Params.tools_required }}
                    <li class="flex items-center text-sm">
                        <svg class="w-4 h-4 text-green-500 mr-2 flex-shrink-0"
                            fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        {{ . }}
                    </li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}

            <!-- Materials Required -->
            {{ if .Params.materials_required }}
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <h3 class="text-lg font-semibold mb-3">Materials Required</h3>
                <ul class="space-y-2">
                    {{ range .Params.materials_required }}
                    <li class="flex items-start text-sm">
                        <svg class="w-4 h-4 text-blue-500 mr-2 mt-0.5 flex-shrink-0"
                            fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2"
                                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4">
                            </path>
                        </svg>
                        {{ . }}
                    </li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}

            <!-- Project Info -->
            <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                <h3 class="text-lg font-semibold mb-3">Project Details</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Type:</span>
                        <span class="font-medium">{{ .Params.project_type |
                            title }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Difficulty:</span>
                        <span class="font-medium">{{ .Params.difficulty | title
                            }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Duration:</span>
                        <span class="font-medium">{{ .Params.duration }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Cost:</span>
                        <span class="font-medium">{{ .Params.cost }}</span>
                    </div>
                    {{ if .Params.schematic_included }}
                    <div class="pt-2 border-t">
                        <a href="#"
                            class="flex items-center text-blue-600 hover:text-blue-700">
                            <svg class="w-4 h-4 mr-2" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round"
                                    stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Download Schematic
                        </a>
                    </div>
                    {{ end }}
                    {{ if .Params.pcb_included }}
                    <div>
                        <a href="#"
                            class="flex items-center text-blue-600 hover:text-blue-700">
                            <svg class="w-4 h-4 mr-2" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round"
                                    stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Download PCB Files
                        </a>
                    </div>
                    {{ end }}
                </div>
            </div>

            <!-- Related Projects -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="text-lg font-semibold mb-3">Related Projects</h3>
                <div class="space-y-3">
                    {{ $related := .Site.RegularPages.Related . | first 3 }}
                    {{ range $related }}
                    <a href="{{ .Permalink }}"
                        class="block p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <h4 class="font-medium text-sm mb-1">{{ .Title }}</h4>
                        <div
                            class="flex items-center space-x-2 text-xs text-gray-600">
                            <span>{{ .Params.difficulty | title }}</span>
                            <span>â€¢</span>
                            <span>{{ .Params.duration | default "2 hours"
                                }}</span>
                        </div>
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const startBtn = document.getElementById('start-project-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const phasesCompleted = document.getElementById('phases-completed');
        const prevPhaseBtn = document.getElementById('prev-phase');
        const nextPhaseBtn = document.getElementById('next-phase');

        // Project phase tracking
        if (startBtn && progressBar) {
            let currentPhase = 0;
            const totalPhases = document.querySelectorAll('.project-content h3').length || 3; // Default to 3 phases

            phasesCompleted.textContent = `${currentPhase} of ${totalPhases} phases completed`;

            function updateProgress() {
                const progress = (currentPhase / totalPhases) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}%`;
                phasesCompleted.textContent = `${currentPhase} of ${totalPhases} phases completed`;

                prevPhaseBtn.disabled = currentPhase === 0;
                nextPhaseBtn.disabled = currentPhase === totalPhases;

                if (currentPhase === totalPhases) {
                    nextPhaseBtn.textContent = 'Project Complete!';
                    nextPhaseBtn.classList.add('bg-green-600');
                    nextPhaseBtn.classList.remove('bg-blue-600');
                }
            }

            startBtn.addEventListener('click', function () {
                document.getElementById('project-progress').scrollIntoView({ behavior: 'smooth' });
            });

            nextPhaseBtn.addEventListener('click', function () {
                if (currentPhase < totalPhases) {
                    currentPhase++;
                    updateProgress();
                }
            });

            prevPhaseBtn.addEventListener('click', function () {
                if (currentPhase > 0) {
                    currentPhase--;
                    updateProgress();
                }
            });
        }
    });
</script>
{{ end }}